<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>KARABAS</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #1A1A1A;
      font-family: Arial, sans-serif;
      color: #f2f2f2;
      font-size: 16px;
    }
    a {
      color: #f2f2f2;
      text-decoration: none;
    }
    .wrapper-def {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container-def {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .top-menu {
      position: sticky;
      top: 0;
      background: #2D2D2D;
      z-index: 100;
      padding: 15px 0;
    }
    .top-menu__wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .top-menu__content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }
    .top-menu__left {
      display: flex;
      align-items: center;
    }
    .top-menu__right {
      display: flex;
      align-items: center;
    }
    .top-menu__logo {
      font-size: 24px;
      font-weight: bold;
    }
    .top-menu__btn {
      display: none;
      cursor: pointer;
    }
    .links-def {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
    }
    .mob-menu {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #2D2D2D;
      z-index: 200;
    }
    .mob-menu.active {
      display: block;
    }
    .mob-menu__wrap {
      padding: 20px;
    }
    .mob-menu__content {
      position: relative;
      height: 100%;
    }
    .mob-menu__top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .mob-menu__btn {
      cursor: pointer;
    }
    .mob-menu__links {
      list-style: none;
      padding: 0;
      margin: 20px 0;
    }
    .mob-menu__footer {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
    }
    .sec-header {
      padding: 40px 0;
      position: relative;
    }
    .sec-header__title {
      margin-bottom: 20px;
    }
    .img-def {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    .img-def__dec {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      max-width: 800px;
      z-index: 1;
    }
    .img-def__img {
      width: 100%;
      max-width: 600px;
      position: relative;
      z-index: 2;
    }
    .sec-header__title2 {
      margin-top: 20px;
    }
    .sec-header__arr {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    .sec-info {
      padding: 40px 0;
    }
    .sec-info__top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .title-def {
      margin: 0;
    }
    .title-def_red {
      color: #E53E3E;
    }
    .title-def_sec {
      font-size: 24px;
      font-weight: bold;
    }
    .title-def_main {
      font-size: 32px;
      font-weight: bold;
    }
    .title-def_med {
      font-size: 24px;
      font-weight: bold;
    }
    .link-arr {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #f2f2f2;
      text-decoration: none;
    }
    .link-arr__text {
      font-size: 16px;
    }
    .sec-info__content {
      display: grid;
      gap: 40px;
    }
    .block-info {
      background: #2D2D2D;
      padding: 20px;
      border-radius: 8px;
    }
    .block-info__title {
      margin-bottom: 15px;
    }
    .block-info__content {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .block-info__img {
      width: 100%;
      max-width: 400px;
      height: auto;
      object-fit: cover;
      border-radius: 8px;
    }
    .block-info__body {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
      flex: 1;
    }
    .block-info__arr {
      display: flex;
      align-items: center;
      margin-left: 10px;
    }
    .block-info__arr-left {
      margin-left: 0;
      margin-right: 10px;
    }
    .btn-def {
      display: inline-block;
      background: #E53E3E;
      color: #f2f2f2;
      padding: 15px 30px;
      border-radius: 5px;
      text-decoration: none;
      margin-top: 5px;
    }
    .btn-def span {
      font-size: 18px;
    }
    .block-info.arr-right .block-info__content {
      flex-direction: row;
    }
    .block-info.arr-left .block-info__content {
      flex-direction: row-reverse;
    }
    .sec-footer {
      margin-top: auto;
      padding: 20px 0;
      background: #2D2D2D;
      text-align: center;
    }
    .sec-footer__text {
      font-size: 14px;
      color: #f2f2f2;
      margin: 5px 0;
    }
    .sec-footer__bottom {
      margin-top: 10px;
    }
    .sec-footer__bottom a {
      color: #f2f2f2;
      text-decoration: underline;
      margin: 0 10px;
    }
    @media (max-width: 768px) {
      .top-menu__btn {
        display: block;
      }
      .top-menu__links {
        display: none;
      }
      .block-info__content {
        flex-direction: column;
      }
      .block-info.arr-right .block-info__content {
        flex-direction: column;
      }
      .block-info.arr-left .block-info__content {
        flex-direction: column;
      }
      .block-info__img {
        width: 100%;
        max-width: 100%;
      }
      .block-info__arr {
        margin: 10px 0;
      }
      .block-info__arr-left {
        margin: 10px 0;
      }
      .btn-def {
        padding: 12px 25px;
      }
      .btn-def span {
        font-size: 16px;
      }
    }
    #city-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #city-modal-content {
      background: #2D2D2D;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    #city-modal-content h2 {
      color: #f2f2f2;
      margin-bottom: 15px;
    }
    #city-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #1A1A1A;
      color: #f2f2f2;
    }
    #city-submit {
      background: #E53E3E;
      color: #f2f2f2;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #city-submit:hover {
      background: #C53030;
    }
    #chat-window {
      transition: transform 0.3s ease;
      transform: translateY(100%);
      width: 90vw;
      max-width: 360px;
      border-radius: 1rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background: #2D2D2D;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    #chat-window.open {
      transform: translateY(0);
    }
    #chat-messages {
      flex: 1 1 auto;
      overflow-y: auto;
      overscroll-behavior: contain;
      scrollbar-width: thin;
      scrollbar-color: #CBD5E0 transparent;
      max-height: 60vh;
      padding: 1rem;
      box-sizing: border-box;
      -webkit-overflow-scrolling: auto;
    }
    #chat-messages::-webkit-scrollbar {
      width: 0.5rem;
    }
    #chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }
    #chat-messages::-webkit-scrollbar-thumb {
      background: #CBD5E0;
      border-radius: 0.25rem;
    }
    #chat-messages::-webkit-scrollbar-thumb:hover {
      background: #94A3B8;
    }
    .chat-bubble {
      max-width: 80%;
      margin: 0.5rem 0.75rem;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      word-break: break-word;
      box-sizing: border-box;
      animation: slideIn 0.2s ease;
      font-size: 0.95rem;
    }
    .user-message {
      background: linear-gradient(to right, #E53E3E, #FF6666);
      color: #f2f2f2;
      margin-left: auto;
    }
    .moderator-message {
      background: #444;
      color: #f2f2f2;
    }
    .bot-message {
      background: #666;
      color: #f2f2f2;
      text-align: center;
      margin: 0.5rem auto;
    }
    .media {
      max-width: 100%;
      max-height: 12rem;
      width: auto;
      height: auto;
      border-radius: 0.5rem;
      object-fit: contain;
      margin: 0.3rem 0;
      display: block;
    }
    .input-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
      box-sizing: border-box;
      padding: 0 0.5rem;
    }
    .file-upload-btn {
      cursor: pointer;
      transition: transform 0.2s;
      flex-shrink: 0;
      padding: 0.5rem;
      touch-action: manipulation;
    }
    .file-upload-btn:hover {
      transform: scale(1.1);
    }
    @keyframes slideIn {
      from { transform: translateY(0.5rem); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @media (max-width: 640px) {
      #chat-window {
        bottom: 0.5rem;
        right: 0.5rem;
        height: 85vh;
        max-height: 600px;
      }
      #chat-messages {
        max-height: 65vh;
      }
      .chat-bubble {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
      }
      .media {
        max-height: 10rem;
      }
    }
    @media (min-width: 641px) and (max-width: 1024px) {
      #chat-window {
        max-width: 400px;
        height: 70vh;
      }
      #chat-messages {
        max-height: 50vh;
      }
    }
    @media (min-width: 1025px) {
      #chat-window {
        max-width: 420px;
        height: 600px;
      }
      #chat-messages {
        max-height: 450px;
      }
    }
    @media (hover: none) {
      #chat-messages::-webkit-scrollbar {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Модальное окно для ввода города -->
  <div id="city-modal">
    <div id="city-modal-content">
      <h2>Введите ваш город</h2>
      <input type="text" id="city-input" placeholder="Например, Москва">
      <button id="city-submit">Подтвердить</button>
    </div>
  </div>

  <div class="wrapper-def">
    <header class="top-menu">
      <div class="container-def">
        <div class="top-menu__wrap">
          <div class="top-menu__content">
            <div class="top-menu__left">
              <a href="./" class="top-menu__logo logo-def">KARABAS</a>
            </div>
            <div class="top-menu__right">
              <nav class="top-menu__links">
                <ul class="links-def"></ul>
              </nav>
              <svg class="top-menu__btn" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 9H0" stroke="#F2F2F2" stroke-width="2" />
                <path d="M16 5H0" stroke="#F2F2F2" stroke-width="2" />
                <path d="M16 1H0" stroke="#F2F2F2" stroke-width="2" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="mob-menu">
      <div class="mob-menu__wrap">
        <div class="mob-menu__content">
          <div class="mob-menu__top">
            <a href="./" class="mob-menu__logo logo-def">KARABAS</a>
            <svg class="mob-menu__btn" width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14.9066 0.996043L1 11.004" stroke="#F2F2F2" stroke-width="2" />
              <path d="M14.9999 11.004L1.00003 0.996055" stroke="#F2F2F2" stroke-width="2" />
            </svg>
          </div>
          <ul class="mob-menu__links"></ul>
        </div>
      </div>
      <div class="mob-menu__footer sec-footer">
        <div class="sec-footer__wrap">
          <div class="sec-footer__content">
            <div class="sec-footer__text sec-footer__text-1">© ООО "Городские Зрелищные Кассы", 2025</div>
            <div class="sec-footer__text">Все права защищены.</div>
            <div class="sec-footer__text">Для лиц старше 18 лет.</div>
            <div class="sec-footer__bottom">
              <a class="sec-footer__text" href="/refund.pdf">Возврат и условия</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <section class="sec-header" style="display:none;">
      <div class="container-def">
        <div class="sec-header__wrap">
          <div class="sec-header__content">
            <div class="sec-header__title title-def title-def_sec">ПРЕМЬЕРА</div>
            <div class="img-def">
              <img class="img-def__dec" src="/dec.png" alt="">
              <img class="img-def__img" src="" alt="">
            </div>
            <div class="sec-header__title2 title-def title-def_main"></div>
            <svg class="sec-header__arr" width="1221" height="628" viewBox="0 0 1221 628" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2 0V593H1215M1215 593L1132 560M1215 593L1132 626" stroke="#F2F2F2" stroke-width="4" />
            </svg>
          </div>
        </div>
      </div>
    </section>
    <section class="sec-info">
      <div class="container-def">
        <div class="sec-info__wrap">
          <div class="sec-info__top">
            <h2 class="sec-info__title title-def title-def_red title-def_main">НОВИНКИ ТЕАТРА</h2>
            <a class="link-arr" onclick="return false;">
              <span class="link-arr__text">КО ВСЕМ СОБЫТИЯМ</span>
              <svg class="link-arr__arr" width="41" height="46" viewBox="0 0 41 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1.98438 44L37 24L1.98438 2" stroke="#F2F2F2" stroke-width="4" />
              </svg>
            </a>
          </div>
          <div class="sec-info__content">
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Раневская «Сквозь смех и слезы»</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240530170344837.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span ana></a>
                </div>
              </div>
            </div>
            <div class="block-info arr-right sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Старший сын</h3>
              <div class="block-info__content">
                <img class="block-info__img" src="/20240530172148690.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
                <svg class="block-info__arr" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
              </div>
            </div>
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Анна Каренина</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240530165722715.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="sec-info">
      <div class="container-def">
        <div class="sec-info__wrap">
          <div class="sec-info__top">
            <h2 class="sec-info__title title-def title-def_red title-def_main">ОПЕРА И БАЛЕТ</h2>
            <a class="link-arr" onclick="return false;">
              <span class="link-arr__text">КО ВСЕМ СОБЫТИЯМ</span>
              <svg class="link-arr__arr" width="41" height="46" viewBox="0 0 41 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1.98438 44L37 24L1.98438 2" stroke="#F2F2F2" stroke-width="4" />
              </svg>
            </a>
          </div>
          <div class="sec-info__content">
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Князь Игорь</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240530173340807.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
              </div>
            </div>
            <div class="block-info arr-right sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Спартак</h3>
              <div class="block-info__content">
                <img class="block-info__img" src="/20240530181609305.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
                <svg class="block-info__arr" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
              </div>
            </div>
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Золушка</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240530180935428.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="sec-info">
      <div class="container-def">
        <div class="sec-info__wrap">
          <div class="sec-info__top">
            <h2 class="sec-info__title title-def title-def_red title-def_main">ВЫСТАВКИ</h2>
            <a class="link-arr" onclick="return false;">
              <span class="link-arr__text">КО ВСЕМ СОБЫТИЯМ</span>
              <svg class="link-arr__arr" width="41" height="46" viewBox="0 0 41 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1.98438 44L37 24L1.98438 2" stroke="#F2F2F2" stroke-width="4" />
              </svg>
            </a>
          </div>
          <div class="sec-info__content">
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Город-сад: мультивселенные</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240531130212608.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
              </div>
            </div>
            <div class="block-info arr-right sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Lila</h3>
              <div class="block-info__content">
                <img class="block-info__img" src="/20240531130531732.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
                <svg class="block-info__arr" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
              </div>
            </div>
            <div class="block-info arr-left sec-info__content-el">
              <h3 class="block-info__title title-def title-def_med">Между землей и небом</h3>
              <div class="block-info__content">
                <svg class="block-info__arr block-info__arr-left" width="46" height="281" viewBox="0 0 46 281" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M23 0V277M23 277L2 243M23 277L44 243" stroke="#F2F2F2" stroke-width="4" />
                </svg>
                <img class="block-info__img" src="/20240602112419843.jpg" alt="">
                <div class="block-info__body">
                  <div class="title-small block-info__title2"></div>
                  <a class="btn-def block-info__btn" onclick="return false;"><span>КУПИТЬ БИЛЕТЫ</span></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="sec-footer">
      <div class="container-def">
        <div class="sec-footer__wrap">
          <div class="sec-footer__content">
            <div class="sec-footer__text sec-footer__text-1">© ООО "Городские Зрелищные Кассы", 2025<br>
Все права защищены.<br>
Для лиц старше 18 лет.</div>
            <div class="sec-footer__bottom">
              <a class="sec-footer__text" href="/refund.pdf">Возврат и условия</a>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- HTML для чата -->
  <div id="chat-window" class="fixed bottom-5 right-5 flex-col hidden" role="dialog" aria-label="Чат техподдержки">
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-t-[1rem] flex justify-between items-center">
      <div class="flex items-center">
        <h2 class="text-lg font-semibold">Техподдержка</h2>
        <span class="ml-2 w-3 h-3 bg-green-500 rounded-full" title="В сети"></span>
      </div>
      <button id="close-chat" class="text-white hover:text-gray-200 text-xl" aria-label="Закрыть чат">×</button>
    </div>
    <div id="chat-messages" class="p-4" role="log" aria-live="polite"></div>
    <div class="p-4 border-t bg-gray-50">
      <div class="input-container">
        <label class="file-upload-btn" aria-label="Загрузить файл">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 002.828 2.828L17 11.828V15m0 0v6m0-6h-6m6 0H9"></path>
          </svg>
          <input id="file-input" type="file" accept="image/*,video/*" class="hidden">
        </label>
        <input id="chat-input" type="text" placeholder="Введите сообщение..." class="flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Поле ввода сообщения">
      </div>
      <div id="upload-status" class="text-sm text-gray-500 mt-2 hidden" role="status"></div>
    </div>
  </div>
  <button id="open-chat" class="fixed bottom-5 right-5 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition-transform hover:scale-105" aria-label="Открыть чат">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
    </svg>
  </button>

  <script src="/main.js"></script>
  <script>
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    let userId = localStorage.getItem('userId');
    if (!userId) {
      userId = generateUUID();
      localStorage.setItem('userId', userId);
    }

    const botToken = '7669114954:AAFCoZvwN9AuSvkqtotvosW4kh0l5DzbKqg';
    const admins = [
      { chatId: '7066276424', name: 'Модератор' },
      { chatId: '7409970440', name: 'Модератор' },
      { chatId: '2079893058', name: 'Модератор' }
    ];
    const telegramApiUrl = `https://api.telegram.org/bot${botToken}`;
    let messages = [];
    let lastUpdateIds = { '7066276424': 0, '7409970440': 0, '2079893058': 0 };
    let pendingReplies = {};
    let sendQueue = Promise.resolve();

    const chatWindow = document.getElementById('chat-window');
    const openChatBtn = document.getElementById('open-chat');
    const closeChatBtn = document.getElementById('close-chat');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const fileInput = document.getElementById('file-input');
    const uploadStatus = document.getElementById('upload-status');

    openChatBtn.addEventListener('click', () => {
      chatWindow.classList.toggle('hidden');
      chatWindow.classList.toggle('open');
      openChatBtn.classList.toggle('hidden');
      scrollToBottom();
    });

    closeChatBtn.addEventListener('click', () => {
      chatWindow.classList.add('hidden');
      chatWindow.classList.remove('open');
      openChatBtn.classList.remove('hidden');
    });

    chatInput.addEventListener('keypress', async (e) => {
      if (e.key === 'Enter' && chatInput.value.trim()) {
        const message = chatInput.value.trim();
        messages.push({ sender: 'user', text: message });
        renderMessages();
        queueSend(() => sendMessageToAdmins(message));
        chatInput.value = '';
      }
    });

    fileInput.addEventListener('change', async () => {
      const file = fileInput.files[0];
      if (!file) return;
      if (file.size > 10 * 1024 * 1024) {
        uploadStatus.classList.remove('hidden');
        uploadStatus.textContent = 'Ошибка: файл больше 10 МБ';
        setTimeout(() => uploadStatus.classList.add('hidden'), 3000);
        fileInput.value = '';
        return;
      }
      uploadStatus.classList.remove('hidden');
      uploadStatus.textContent = 'Загрузка...';
      queueSend(() => sendMediaToAdmins(file));
      uploadStatus.classList.add('hidden');
      fileInput.value = '';
    });

    function scrollToBottom() {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function renderMessages() {
      if (messages.length > 1000) messages = messages.slice(-500);

      const lastMessageCount = chatMessages.childElementCount;
      const newMessages = messages.slice(lastMessageCount);
      newMessages.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-bubble ${msg.sender === 'user' ? 'user-message' : msg.sender === 'bot' ? 'bot-message' : 'moderator-message'}`;
        
        if (msg.text) {
          messageDiv.textContent = msg.sender === 'user' || msg.sender === 'bot' ? msg.text : `${msg.adminName}: ${msg.text}`;
        }
        if (msg.mediaUrl) {
          const media = document.createElement(msg.mediaType === 'photo' ? 'img' : 'video');
          media.src = msg.mediaUrl;
          media.className = 'media';
          if (msg.mediaType === 'video') media.controls = true;
          messageDiv.appendChild(media);
        }
        
        chatMessages.appendChild(messageDiv);
      });
      scrollToBottom();
    }

    function queueSend(fn) {
      sendQueue = sendQueue.then(() => fn()).catch(error => {
        console.error('Ошибка в очереди отправки:', error);
        messages.push({ sender: 'bot', text: 'Ошибка отправки. Попробуйте снова.' });
        renderMessages();
      });
    }

    async function sendMessageToAdmins(message) {
      const results = await Promise.all(admins.map(admin => 
        fetch(`${telegramApiUrl}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: admin.chatId,
            text: `ID: ${userId}\nСообщение с сайта: ${message}`,
            reply_markup: {
              inline_keyboard: [[
                { text: 'Ответить', callback_data: `reply:${userId}` }
              ]]
            }
          })
        }).then(res => res.json())
      ));
      
      const success = results.every(data => data.ok);
      messages.push({ sender: 'bot', text: success ? 'Сообщение отправлено техподдержке!' : 'Ошибка отправки сообщения.' });
      renderMessages();
    }

    async function sendMediaToAdmins(file) {
      const isPhoto = file.type.startsWith('image/');
      const method = isPhoto ? 'sendPhoto' : 'sendVideo';
      
      const results = await Promise.all(admins.map(admin => {
        const formData = new FormData();
        formData.append(isPhoto ? 'photo' : 'video', file);
        formData.append('chat_id', admin.chatId);
        formData.append('caption', `ID: ${userId}\nМедиа с сайта`);
        formData.append('reply_markup', JSON.stringify({
          inline_keyboard: [[
            { text: 'Ответить', callback_data: `reply:${userId}` }
          ]]
        }));
        return fetch(`${telegramApiUrl}/${method}`, {
          method: 'POST',
          body: formData
        }).then(res => res.json());
      }));

      const success = results.every(data => data.ok);
      if (success) {
        const url = URL.createObjectURL(file);
        messages.push({ sender: 'user', mediaUrl: url, mediaType: isPhoto ? 'photo' : 'video' });
      }
      messages.push({ sender: 'bot', text: success ? 'Медиа отправлено техподдержке!' : 'Ошибка отправки медиа.' });
      renderMessages();
    }

    async function checkForMessages() {
      try {
        const response = await fetch(`${telegramApiUrl}/getUpdates`);
        const data = await response.json();
        if (!data.ok || !data.result.length) return;

        const updates = data.result;
        const newMessages = [];

        for (const update of updates) {
          const chatId = update.message?.chat?.id?.toString() || update.callback_query?.message?.chat?.id?.toString();
          const admin = admins.find(a => a.chatId === chatId);
          if (!admin || update.update_id <= lastUpdateIds[chatId]) continue;

          if (update.callback_query) {
            const callbackData = update.callback_query.data;
            const messageId = update.callback_query.message.message_id;
            if (callbackData.startsWith('reply:')) {
              const targetUserId = callbackData.split(':')[1];
              pendingReplies[chatId] = { userId: targetUserId, messageId };
              await fetch(`${telegramApiUrl}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  chat_id: chatId,
                  text: `Введите ответ для пользователя ${targetUserId}`,
                  reply_to_message_id: messageId
                })
              });
            }
          }

          const message = update.message || update.edited_message;
          if (message && pendingReplies[chatId]?.userId === userId) {
            const targetUserId = pendingReplies[chatId].userId;

            if (message.text) {
              newMessages.push({ sender: chatId, adminName: admin.name, text: message.text });
            }

            if (message.photo) {
              const photo = message.photo[message.photo.length - 1];
              const response = await fetch(`${telegramApiUrl}/getFile?file_id=${photo.file_id}`);
              const fileData = await response.json();
              if (fileData.ok) {
                const fileUrl = `https://api.telegram.org/file/bot${botToken}/${fileData.result.file_path}`;
                newMessages.push({ sender: chatId, adminName: admin.name, mediaUrl: fileUrl, mediaType: 'photo' });
              }
            }

            if (message.video) {
              const response = await fetch(`${telegramApiUrl}/getFile?file_id=${message.video.file_id}`);
              const fileData = await response.json();
              if (fileData.ok) {
                const fileUrl = `https://api.telegram.org/file/bot${botToken}/${fileData.result.file_path}`;
                newMessages.push({ sender: chatId, adminName: admin.name, mediaUrl: fileUrl, mediaType: 'video' });
              }
            }

            delete pendingReplies[chatId];
          }

          lastUpdateIds[chatId] = update.update_id;
        }

        if (newMessages.length) {
          messages.push(...newMessages);
          renderMessages();
        }
      } catch (error) {
        console.error('Ошибка проверки сообщений:', error);
      }
    }

    setInterval(checkForMessages, 3000);

    // Логика для модального окна и генерации ссылки с переводом
    const cityModal = document.getElementById('city-modal');
    const cityInput = document.getElementById('city-input');
    const citySubmit = document.getElementById('city-submit');

    // Проверяем, есть ли параметр 'c' в URL
    const urlParams = new URLSearchParams(window.location.search);
    const cityParam = urlParams.get('c');

    if (!cityParam) {
      // Если параметра нет, показываем модальное окно
      cityModal.style.display = 'flex';
    } else {
      // Если параметр есть, скрываем модальное окно и показываем контент
      cityModal.style.display = 'none';
    }

    // Функция для определения языка текста
    function detectLanguage(text) {
      const cyrillicPattern = /[а-яА-Я]/;
      if (cyrillicPattern.test(text)) {
        return 'ru'; // Русский
      }
      return 'en'; // Предполагаем, что остальные языки не требуют перевода, или можно добавить больше условий
    }

    // Функция для перевода текста с использованием публичного API (MyMemory Translation API)
    async function translateCity(city, sourceLang, targetLang) {
      try {
        const response = await fetch(
          `https://api.mymemory.translated.net/get?q=${encodeURIComponent(city)}&langpair=${sourceLang}|${targetLang}`
        );
        const data = await response.json();
        if (data.responseStatus === 200 && data.matches && data.matches.length > 0) {
          return data.matches[0].translation;
        } else {
          console.error('Ошибка перевода:', data);
          return city; // Возвращаем оригинальный текст в случае ошибки
        }
      } catch (error) {
        console.error('Ошибка при запросе перевода:', error);
        return city; // Возвращаем оригинальный текст в случае ошибки
      }
    }

    citySubmit.addEventListener('click', async () => {
      let city = cityInput.value.trim();
      if (city) {
        // Определяем язык введённого города
        const sourceLang = detectLanguage(city);
        
        // Если язык русский, переводим на английский
        if (sourceLang === 'ru') {
          city = await translateCity(city, 'ru', 'en');
        }
        
        // Приводим к нижнему регистру и формируем URL
        city = city.toLowerCase();
        const newUrl = `${window.location.pathname}?c=${city}`;
        window.location.href = newUrl;
      }
    });

    // Добавляем возможность отправки по нажатию Enter
    cityInput.addEventListener('keypress', async (e) => {
      if (e.key === 'Enter') {
        citySubmit.click();
      }
    });

    // Логика для мобильного меню
    const menuBtn = document.querySelector('.top-menu__btn');
    const mobMenu = document.querySelector('.mob-menu');
    const mobMenuCloseBtn = document.querySelector('.mob-menu__btn');

    menuBtn.addEventListener('click', () => {
      mobMenu.classList.add('active');
    });

    mobMenuCloseBtn.addEventListener('click', () => {
      mobMenu.classList.remove('active');
    });
  </script>
</body>
</html>
